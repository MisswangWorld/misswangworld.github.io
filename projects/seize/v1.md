# Seize - Technical Documentation

## Table of Contents

1. [Overview](#overview)
2. [Features](#features)
3. [Technical Highlights](#technical-highlights)
4. [Architecture](#architecture)
5. [Tech Stack](#tech-stack)
6. [Implementation Details](#implementation-details)

---

## Overview

**Seize** is a cross-platform focus timer application built with React Native and Expo. It combines the simplicity of a Pomodoro-style timer with native calendar integration, allowing users to automatically record their focus sessions as calendar events.

### Design Philosophy

- **Minimalist UI**: Clean, distraction-free interface focused on the timer
- **Native Integration**: Deep integration with device calendar and notifications
- **Privacy First**: All data stored locally, no external services
- **Accessibility**: Full localization and responsive design

---

## Features

### 1. Dual Timer Modes

| Mode | Description | Use Case |
|------|-------------|----------|
| **Countdown** | Set duration (1-999 min) | Pomodoro technique, time-boxed tasks |
| **Count-up** | Open-ended stopwatch | Flexible work sessions, tracking total time |

**Countdown Features:**
- Tap to edit duration
- Push notification on completion
- Haptic feedback alert

**Count-up Features:**
- No time limit
- Manual stop when finished
- Tracks exact duration

### 2. Calendar Integration

- **Automatic Event Creation**: Focus sessions saved as calendar events
- **Dedicated Calendar**: Creates a "Seize/拾时" calendar for organization
- **Calendar Selection**: Choose any writable calendar on device
- **Event Details**: Includes tag, start/end time, actual focus duration

### 3. Smart Tagging System

- Custom tags for categorizing sessions
- Auto-suggestions from usage history
- Most recently used tags prioritized
- Calendar association remembered per tag

### 4. Internationalization

| Language | App Name | Support Level |
|----------|----------|---------------|
| English | Seize | Full |
| Chinese (Simplified) | 拾时 | Full |

**Localized Elements:**
- All UI strings
- System permission dialogs
- Push notification content
- Calendar event descriptions

### 5. Adaptive UI

- Portrait and landscape layouts
- iPhone and iPad optimized
- Light/dark mode (follows system)
- Safe area handling

---

## Technical Highlights

### 1. React Native New Architecture

```json
{
  "newArchEnabled": true
}
```

Leverages React Native's new architecture for:
- Fabric renderer (improved UI performance)
- TurboModules (faster native module access)
- Concurrent rendering support

### 2. Timestamp-Based Timer

Instead of counting intervals, the timer uses absolute timestamps:

```typescript
// Calculate elapsed time from timestamps
const getElapsedSeconds = () => {
  const now = status === 'paused' ? pauseTime : Date.now();
  const elapsed = now - startTime - totalPausedDuration;
  return Math.floor(elapsed / 1000);
};
```

**Benefits:**
- Accurate across app background/foreground transitions
- Survives device sleep
- Handles pause/resume correctly
- Can recover pending sessions after app restart

### 3. Zustand State Management

Lightweight, TypeScript-first state management:

```typescript
// timerStore.ts
interface TimerStore {
  mode: 'countdown' | 'countup';
  status: 'idle' | 'running' | 'paused';
  startTime: number | null;
  // ... computed values as methods
  getElapsedSeconds: () => number;
  getRemainingSeconds: () => number;
}

export const useTimerStore = create<TimerStore>((set, get) => ({
  // state and actions
}));
```

**Two stores:**
- `timerStore`: Timer-specific state
- `appStore`: App-wide settings and permissions

### 4. Custom Hooks Architecture

Encapsulates complex logic into reusable hooks:

| Hook | Purpose |
|------|---------|
| `useTimer` | Timer logic, notifications, haptics |
| `useCalendar` | Calendar permissions and API |
| `useOrientation` | Portrait/landscape detection |

### 5. Service Layer Pattern

Clean separation of native API interactions:

```
src/services/
├── calendarService.ts    # Calendar CRUD operations
├── notificationService.ts # Push notification management
└── storageService.ts     # AsyncStorage wrapper
```

### 6. Expo Config Plugins

Custom plugins for native localization:

```javascript
// plugins/withIosLocales.js
// Copies InfoPlist.strings to iOS project
// Adds localization files to Xcode project
// Sets known regions in project settings

// plugins/withAndroidLocales.js
// Copies strings.xml to Android res folders
// Handles values/values-zh-rCN directories
```

### 7. File-Based Routing

Using Expo Router for navigation:

```
app/
├── _layout.tsx    # Root layout with providers
├── index.tsx      # Main timer screen (/)
└── onboarding.tsx # First-time experience (/onboarding)
```

---

## Architecture

### Component Hierarchy

```
App
├── _layout (SafeAreaProvider, ThemeProvider, i18n init)
└── Routes
    ├── index (TimerScreen)
    │   ├── ModeToggle
    │   ├── TimerDisplay
    │   ├── TimerControls
    │   └── EndSessionModal
    │       ├── TagInput
    │       └── CalendarPicker
    └── onboarding (OnboardingScreen)
```

### Data Flow

```
User Action
    ↓
Component (UI)
    ↓
Custom Hook (useTimer, useCalendar)
    ↓
Zustand Store (state management)
    ↓
Service Layer (native API calls)
    ↓
Native Module (expo-calendar, expo-notifications)
```

### State Structure

**Timer Store:**
```typescript
{
  mode: 'countdown' | 'countup',
  status: 'idle' | 'running' | 'paused',
  duration: number,        // countdown duration in seconds
  startTime: number,       // timestamp when started
  pauseTime: number,       // timestamp when paused
  totalPausedDuration: number,
  showEndSession: boolean,
  endSessionData: EndSessionData | null
}
```

**App Store:**
```typescript
{
  onboardingCompleted: boolean,
  calendarPermissionGranted: boolean,
  notificationPermissionGranted: boolean,
  tagHistory: TagHistory[],
  seizeCalendarId: string | null
}
```

---

## Tech Stack

### Core

| Technology | Version | Purpose |
|------------|---------|---------|
| React Native | 0.81.5 | Mobile framework |
| Expo | SDK 54 | Development platform |
| TypeScript | 5.9 | Type safety |
| React | 19.1 | UI library |

### State & Data

| Package | Purpose |
|---------|---------|
| Zustand | State management |
| AsyncStorage | Persistent storage |
| i18next | Internationalization |

### Native Features

| Package | Purpose |
|---------|---------|
| expo-calendar | Calendar read/write |
| expo-notifications | Push notifications |
| expo-haptics | Haptic feedback |
| expo-av | Audio playback |
| expo-localization | Device locale |

### Navigation & UI

| Package | Purpose |
|---------|---------|
| expo-router | File-based routing |
| react-native-safe-area-context | Safe area handling |
| react-native-screens | Native navigation |
| react-native-gesture-handler | Touch handling |

---

## Implementation Details

### Timer Accuracy

The timer maintains accuracy by:

1. **Storing absolute timestamps** instead of incrementing counters
2. **Calculating elapsed time** on each render/interval tick
3. **Persisting state** for recovery after app restart
4. **Background handling** via AppState listener

```typescript
useEffect(() => {
  const handleAppStateChange = (nextState: AppStateStatus) => {
    if (nextState === 'active' && status === 'running') {
      // Recalculate time when app returns to foreground
      updateDisplayTime();
    }
  };

  const subscription = AppState.addEventListener('change', handleAppStateChange);
  return () => subscription.remove();
}, [status]);
```

### Calendar Event Creation

```typescript
const createCalendarEvent = async (data: EndSessionData) => {
  const eventId = await Calendar.createEventAsync(data.calendarId, {
    title: data.tag || i18n.t('tags.unnamed'),
    startDate: data.startTime,
    endDate: data.endTime,
    notes: i18n.t('calendar.eventNotes', {
      minutes: Math.floor(data.focusDuration / 60)
    }),
    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
  });
  return eventId;
};
```

### Native Localization

iOS InfoPlist.strings:
```
"CFBundleDisplayName" = "Seize";
"NSCalendarsUsageDescription" = "Seize needs calendar access...";
```

Android strings.xml:
```xml
<resources>
  <string name="app_name">Seize</string>
</resources>
```

### Theme System

```typescript
const colors = {
  light: {
    background: '#FFFFFF',
    text: '#000000',
    textSecondary: '#666666',
    // ...
  },
  dark: {
    background: '#000000',
    text: '#FFFFFF',
    textSecondary: '#999999',
    // ...
  },
  brand: {
    primary: '#FF6B4A',   // Tomato red
    secondary: '#2D5A3D', // Leaf green
  },
};
```

---

## Performance Considerations

1. **Minimal re-renders**: Zustand's selector-based subscriptions
2. **Memoized calculations**: useMemo for derived values
3. **Debounced updates**: Timer display updates every 100ms, not every ms
4. **Lazy loading**: Onboarding screen only loaded when needed

---

## Security & Privacy

- No network requests (except EAS updates if enabled)
- All data stored in device-local AsyncStorage
- Calendar access requires explicit user permission
- No analytics or tracking SDKs

---

## Future Considerations

- Statistics and analytics dashboard
- Custom notification sounds
- Widget support
- Apple Watch companion app
- Export/backup functionality
